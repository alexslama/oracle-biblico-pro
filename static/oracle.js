document.getElementById('analisar-btn').addEventListener('click',async()=>{const query=document.getElementById('query-input').value;if(!query.trim()){alert('Por favor, insira uma pergunta bíblica');return}const processingDiv=document.getElementById('processing-indicator');processingDiv.classList.add('active');try{const response=await fetch('/api/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({query:query})});if(!response.ok)throw new Error(`HTTP error! status: ${response.status}`);const data=await response.json();updateResults(data,query);}catch(error){console.error('Erro:',error);showError('Erro ao processar análise. Tente novamente.');}finally{processingDiv.classList.remove('active')}});function updateResults(data,query){const results=data.analysis||data;document.getElementById('query-meta').textContent=`Query: ${query}`;document.getElementById('timestamp-meta').textContent=`Timestamp: ${new Date().toISOString()}`;const layers=results.analysis_layers||results.layers||[];if(layers.length>0){updateCardContent('linguistica-output',layers[0].language_layer);updateCardContent('numerica-output',layers[1]?.numerical_layer);updateCardContent('historica-output',layers[2]?.historical_layer);updateCardContent('teologica-output',layers[3]?.theological_layer);}if(results.synthesis){const integratedSynthesis=results.synthesis.integrated_synthesis||results.synthesis;updateCardContent('sintese-output',integratedSynthesis);}hideError();}function updateCardContent(elementId,content){const element=document.getElementById(elementId);if(!element)return;if(typeof content==='string'){element.textContent=content;}else if(typeof content==='object'){element.textContent=JSON.stringify(content,null,2);}else{element.textContent='(Sem resultado disponível)';}}function showError(message){const errorBanner=document.getElementById('error-banner');const errorMessage=errorBanner.querySelector('span');errorMessage.textContent=message;errorBanner.hidden=false;}function hideError(){const errorBanner=document.getElementById('error-banner');errorBanner.hidden=true;}
